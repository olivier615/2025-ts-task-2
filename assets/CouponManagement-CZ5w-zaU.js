import{a as j,r as b,d as V,u as P,o as T,b as B,w as L,c as A,e as f,f as _,g as e,t as v,h as r,i as C,v as x,j as E,q as S,m as F,F as D,n as N,p as R}from"./index-D3fxxjD-.js";import{M as I,_ as z}from"./DeleteModal.vue_vue_type_script_setup_true_lang-B9FkMIM7.js";const G="https://ec-course-api.hexschool.io",M="otispathway",h=j.create({baseURL:G});h.interceptors.request.use(o=>{const d=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return d&&(o.headers.Authorization=d),o},o=>Promise.reject(o));h.interceptors.response.use(o=>Promise.resolve(o),o=>Promise.reject(o.response.data));const q=o=>h.get(`/v2/api/${M}/admin/coupons`,{params:o}),H=o=>h.post(`/v2/api/${M}/admin/coupon`,{data:o}),J=o=>{const{data:d,id:m}=o;return h.put(`/v2/api/${M}/admin/coupon/${m}`,{data:d})},K=o=>h.delete(`/v2/api/${M}/admin/coupon/${o}`),U=()=>({id:"",due_date:0,is_enabled:1,percent:0,title:"",code:""});function O(){const o=b(U()),d=b("新增優惠券"),m=p=>{p?(o.value={...p},d.value="編輯優惠券"):c()},c=()=>{o.value=U(),d.value="新增優惠券"};return{form:o,formTitle:d,loadCoupon:m,resetForm:c}}const Q={class:"modal-dialog modal-dialog-centered modal-lg"},W={class:"modal-content rounded-lg"},X={class:"modal-header"},Y={class:"modal-title",id:"addNewCouponModalLabel"},Z={class:"modal-body"},ee={class:"row"},te={class:"col-md-6"},oe={class:"mb-3"},se={class:"row"},ne={class:"col-6 mb-3"},le={class:"col-6 mb-3"},ae={class:"row"},de={class:"col-6 mb-3"},ie={class:"mb-3 d-flex align-items-center"},ce={class:"form-check form-switch"},ue={class:"modal-footer"},re=["disabled"],pe=V({__name:"CouponModal",props:{coupon:{}},emits:["get-coupons"],setup(o,{expose:d,emit:m}){const c=m,p=P("modalRef");let i=null;T(()=>{p.value&&(i=new I(p.value))}),B(()=>{i&&i.dispose()});const g=()=>{i&&i.show()},y=()=>{i&&i.hide()},{form:l,formTitle:k,loadCoupon:$}=O();L(()=>o.coupon,s=>{s.id?$(s):$(null)},{immediate:!0,deep:!0});const w=A(()=>!!o.coupon.id),a=b(!1),n=async()=>{const{id:s,...t}=l.value,u={...t};a.value=!0;try{w.value&&s?await J({data:u,id:s}):await H(u),y()}catch{alert("新增/編輯產品失敗")}finally{a.value=!1,c("get-coupons")}};return d({openModal:g,closeModal:y}),(s,t)=>(_(),f("div",{ref_key:"modalRef",ref:p,class:"modal fade",id:"addNewCouponModal",tabindex:"-1","aria-labelledby":"addNewCouponModalLabel","aria-hidden":"true"},[e("div",Q,[e("div",W,[e("div",X,[e("h5",Y,v(r(k)),1),e("button",{onClick:y,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]),e("div",Z,[e("div",ee,[e("div",te,[e("form",null,[e("div",oe,[t[5]||(t[5]=e("label",{for:"couponName",class:"form-label"},"優惠券名稱",-1)),C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>r(l).title=u),type:"text",class:"form-control rounded-lg",id:"couponName"},null,512),[[x,r(l).title]])]),e("div",se,[e("div",ne,[t[6]||(t[6]=e("label",{for:"couponDue_date",class:"form-label"},"期限",-1)),C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=u=>r(l).due_date=u),type:"number",class:"form-control rounded-lg",id:"couponDue_date"},null,512),[[x,r(l).due_date]])]),e("div",le,[t[7]||(t[7]=e("label",{for:"couponPercent",class:"form-label"},"折扣",-1)),C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=u=>r(l).percent=u),type:"number",class:"form-control rounded-lg",id:"couponPercent"},null,512),[[x,r(l).percent]])])]),e("div",ae,[e("div",de,[t[8]||(t[8]=e("label",{for:"couponCode",class:"form-label"},"折扣碼",-1)),C(e("input",{"onUpdate:modelValue":t[3]||(t[3]=u=>r(l).code=u),class:"form-control rounded-lg",id:"couponCode"},null,512),[[x,r(l).code]])])]),e("div",ie,[t[9]||(t[9]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",ce,[C(e("input",{"onUpdate:modelValue":t[4]||(t[4]=u=>r(l).is_enabled=u),class:"form-check-input",type:"checkbox",id:"flexSwitchCouponEnable","true-value":1,"false-value":0},null,512),[[E,r(l).is_enabled]])])])])])])]),e("div",ue,[e("button",{onClick:y,type:"button",class:"btn btn-outline-secondary rounded-lg"}," 取消 "),e("button",{onClick:n,disabled:a.value,type:"button",class:"btn btn-dark rounded-lg"}," 儲存 ",8,re)])])])],512))}}),me={class:"d-flex justify-content-end align-items-center mb-4"},be={class:"card shadow-sm rounded-lg flex-grow-1"},fe={class:"card-body p-4"},_e={class:"table-responsive"},ve={class:"table table-hover align-middle"},he={class:"text-center"},ge={class:"form-check form-switch d-flex justify-content-center align-items-center"},ye=["checked"],Ce={class:"text-nowrap"},ke=["onClick"],$e=["onClick"],xe={class:"d-flex justify-content-center mt-4"},Me={class:"pagination"},we={class:"page-item"},De=["disabled"],Re={class:"page-item"},Pe=["onClick","disabled"],Se={class:"page-item"},Ne=["disabled"],je=V({__name:"CouponManagement",setup(o){const d=P("couponModalRef"),m=P("deleteModalRef"),c=b("1"),p=b([]),i=b({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),g=async()=>{try{const a=await q({page:c.value});p.value=a.data.coupons,i.value=a.data.pagination}catch{alert("取得產品列表失敗")}};T(()=>{g()});const l=b({id:"",due_date:0,is_enabled:1,percent:0,title:"",code:""}),k=(a=null)=>{a?(l.value={...a},d.value?.openModal()):(l.value={id:"",due_date:0,is_enabled:1,percent:0,title:"",code:""},d.value?.openModal())},$=a=>{m.value?.openModal(()=>w(a))},w=async a=>{try{await K(a)}catch{alert("刪除商品失敗")}finally{g()}};return(a,n)=>(_(),f(D,null,[e("div",me,[e("button",{onClick:n[0]||(n[0]=s=>k(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...n[3]||(n[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),F("新增優惠券 ",-1)])])]),e("div",be,[e("div",fe,[e("div",_e,[e("table",ve,[n[4]||(n[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"期限"),e("th",{scope:"col"},"折扣碼"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(_(!0),f(D,null,N(p.value,s=>(_(),f("tr",{key:s.id},[e("td",null,v(s.title),1),e("td",null,v(s.percent),1),e("td",null,v(s.due_date),1),e("td",null,v(s.code),1),e("td",he,[e("div",ge,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!s.is_enabled},null,8,ye)])]),e("td",Ce,[e("button",{onClick:t=>k(s),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 編輯 ",8,ke),e("button",{onClick:t=>$(s.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,$e)])]))),128))])])]),e("nav",xe,[e("ul",Me,[e("li",we,[e("button",{onClick:n[1]||(n[1]=s=>c.value=String(Number(c.value)-1)),disabled:!i.value?.has_pre,type:"button",class:R(["page-link",{disabled:!i.value?.has_pre}]),"aria-label":"Previous"},[...n[5]||(n[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,De)]),(_(!0),f(D,null,N(i.value?.total_pages,s=>(_(),f("li",Re,[e("button",{onClick:t=>c.value=s.toString(),disabled:c.value===s.toString(),type:"button",class:R(["page-link",{active:c.value===s.toString()}])},v(s),11,Pe)]))),256)),e("li",Se,[e("button",{onClick:n[2]||(n[2]=s=>c.value=String(Number(c.value)+1)),disabled:!i.value?.has_next,class:R(["page-link",{disabled:!i.value?.has_next}]),type:"button","aria-label":"Next"},[...n[6]||(n[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,Ne)])])])])]),S(pe,{ref_key:"couponModalRef",ref:d,coupon:l.value,onGetCoupons:g},null,8,["coupon"]),S(z,{ref_key:"deleteModalRef",ref:m,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{je as default};
